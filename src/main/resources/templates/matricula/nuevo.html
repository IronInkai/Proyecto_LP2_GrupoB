<!DOCTYPE HTML>
<html xmlns:th="http://www.thymeleaf.org">

<head>
	<title>Listado de Cursos</title>
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css">
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css">
	<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
</head>

<body>
	<div th:fragment="contenido">

		<div class="card shadow-lg">
			<div class="card-body">

				<form class="row g-3" th:action="@{/matricula/registrar}" method="post">
					<div class="col-md-10">
						<h1 class="m-0">Emisión de matricula</h1>
					</div>

					<div class="col-md-2">
						<button type="submit" class="btn btn-primary w-100">
							Registrar
							<i class="fa-solid fa-floppy-disk"></i>
						</button>
					</div>

					<!-- Información de la Boleta -->
					<div class="card mb-4">
						<div class="card-body">
							<p class="m-0">
								<strong>Fecha:</strong> <span
									th:text="${#dates.format(#dates.createNow(), 'dd/MM/yyyy')}"></span>
							</p>
						</div>
					</div>
				</form>

				<!-- Sección de Selección de Productos -->
				<div class="card mb-4">
					<div class="card-body">

						<!-- Botón para abrir el modal -->
						<button class="btn btn-primary mb-3" data-bs-toggle="modal" data-bs-target="#modalCursos">
							<i class="fa-solid fa-magnifying-glass"></i> Seleccionar Producto
						</button>

						<!-- Producto Seleccionado -->
						<form id="form" novalidate th:action="@{/matricula/agregar}" method="post"
							th:object="${cursoSeleccionado}" class="needs-validation">
							<div class="row g-2 align-items-end">
								<div class="col-md-2">
									<label>Código</label>
									<input type="text" class="form-control" th:field="*{idCurso}" readonly>
								</div>
								<div class="col-md-4">
									<label>Nombre</label>
									<input type="text" class="form-control" th:field="*{nombreCurso}" readonly>
								</div>
								<div class="col-md-2">
									<label>Fecha de inicio</label>
									<input type="text" class="form-control" th:field="*{fechaInicio}">
								</div>
								<div class="col-md-2">
									<label>Horario</label>
									<input type="text" class="form-control" th:field="*{horario}">
								</div>
								<div class="col-md-2">
									<label>Docente</label>
									<input type="text" class="form-control" th:field="*{docente}">
								</div>
								<div class="col-md-2 align-items-end">
									<button class="btn btn-success">
										<i class="fa-solid fa-plus"></i> Agregar
									</button>
								</div>
							</div>
						</form>
					</div>
				</div>

				<!-- Tabla de Detalle de Productos -->
				<div class="card">
					<div class="card-body">
						<h5>Detalle de Productos</h5>
						<div class="table-responsive">
							<table class="table table-bordered align-middle">
								<thead class="table-dark">
									<tr>
										<th>Código</th>
										<th>Nombre</th>
										<th>Fecha de Inicio</th>
										<th>Horario</th>
										<th>Docente</th>
									</tr>
								</thead>
								<tbody>
									<tr th:each="item : ${lstSeleccionado}">
										<td th:text="${item.idCurso}"></td>
										<td th:text="${item.nombreCurso}"></td>
										<td th:text="${item.fechaInicio}"></td>
										<td th:text="${item.horario}"></td>
										<td th:text="${item.docente}"></td>
										<td>
											<form th:action="@{/matricula/quitar}" method="post">
												<input type="hidden" name="idProducto" th:value="${item.idCurso}" />
												<button class="btn btn-danger btn-sm">
													<i class="fa-solid fa-trash"></i> Quitar
												</button>
											</form>
										</td>
									</tr>
								</tbody>
							</table>
						</div>
					</div>
				</div>
			</div>
		</div>
		<!-- Fragmento Modal de Selección de Productos -->
		<div th:replace="fragments/modal-cursos :: modal-productos(${cursos}, 'modalCursos')"></div>

		<th:block th:utext="${alert}"></th:block>
	</div>


	<th:block th:fragment="scripts">
		<script>
			$(document).on('click', '.btnSeleccionar', function () {
				// 1) Lee atributos (recomendado en kebab-case):
				const idCurso = $(this).data('id-curso');
				const descripcion = $(this).data('descripcion');
				const precio = $(this).data('precio');

				// 2) Pasa valores a tus inputs:
				$('#idProducto').val(idProducto);
				$('#descripcion').val(descripcion);
				$('#precio').val(precio);
				$('#cantidad').val(1);

				// 3) Cierra el modal con la API de BS5
				const modalEl = document.getElementById('modalCursos');
				const modal = bootstrap.Modal.getOrCreateInstance(modalEl);
				modal.hide();
			});
		</script>

		<!-- Script de inicialización -->
		<script>
			$(document).ready(function () {
				const idTabla = '#tblSelectorCursos';
				if ($.fn.DataTable.isDataTable(idTabla)) {
					$(idTabla).DataTable().destroy();
				}
				$('#tblSelectorCursos').DataTable({
					lengthMenu: [5, 10],
					pageLength: 5,
					language: {
						url: 'https://cdn.datatables.net/plug-ins/2.3.4/i18n/es-ES.json',
						search: "Filtro general :"
					}
				});
			});
		</script>

		
	</th:block>
</body>

</html>